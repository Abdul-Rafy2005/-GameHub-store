@model IEnumerable<GameHub.Models.BackupLog>
@{ ViewBag.Title = "Database Backups"; }

<div class="hero-banner" style="background-image:url('/Content/hero-placeholder.jpg')">
  <div class="overlay">
    <h1 class="display-6">Admin • Backups</h1>
    <p class="lead">Backup and restore the database.</p>
  </div>
</div>

@if (TempData["BackupSuccess"] != null) { <div class="alert alert-success">@TempData["BackupSuccess"]</div> }
@if (TempData["BackupError"] != null) { <div class="alert alert-danger">@TempData["BackupError"]</div> }

<div class="panel-dark mb-3">
    <div class="d-flex flex-wrap gap-2 align-items-center">
        @using (Html.BeginForm("BackupNow", "BackupLogs", FormMethod.Post, new { @class = "d-inline" })) { @Html.AntiForgeryToken(); <button type="submit" class="btn btn-accent"><i class="bi bi-hdd"></i> Backup Now</button> }
        @using (Html.BeginForm("Restore", "BackupLogs", FormMethod.Post, new { @class = "d-inline" }))
        {
            @Html.AntiForgeryToken()
            var files = ViewBag.BackupFiles as string[];
            <div class="input-group" style="max-width:480px;">
                <label class="input-group-text"><i class="bi bi-arrow-clockwise"></i></label>
                <select name="filePath" id="filePath" class="form-select">
                    @if (files != null) { foreach (var f in files) { <option value="@f">@System.IO.Path.GetFileName(f)</option> } }
                </select>
                <button type="submit" class="btn btn-danger" onclick="return confirm('This will overwrite the current database. Continue?');">Restore</button>
            </div>
        }
    </div>
</div>

<div class="panel-dark">
    <div class="table-responsive">
        <table class="table table-dark table-hover align-middle mb-0">
            <thead><tr><th>Date</th><th>File</th><th>Performed By</th><th class="text-end">Actions</th></tr></thead>
            <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>@item.BackupDate</td>
                    <td>@System.IO.Path.GetFileName(item.FilePath)</td>
                    <td>@item.PerformedBy</td>
                    <td class="text-end">
                        @Html.ActionLink("Details", "Details", new { id=item.BackupID }, new { @class = "btn btn-secondary btn-sm" })
                        @Html.ActionLink("Delete", "Delete", new { id=item.BackupID }, new { @class = "btn btn-danger btn-sm" })
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>
