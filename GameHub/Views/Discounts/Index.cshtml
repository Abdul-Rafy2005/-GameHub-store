@model IEnumerable<GameHub.Models.Discount>
@{
    ViewBag.Title = "Manage Discounts";
}

<div class="hero-banner" style="background-image:url('/Content/hero-placeholder.jpg')">
    <div class="overlay">
        <h1 class="display-6"><i class="bi bi-tag"></i> Discount Management</h1>
        <p class="lead">Create and manage promotional discount codes</p>
    </div>
</div>

<div class="panel-dark mb-3">
    <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="bi bi-percent"></i> Active Discounts</h5>
        <a href="@Url.Action("Create")" class="btn btn-accent"><i class="bi bi-plus-circle"></i> Create New Discount</a>
    </div>
</div>

@if (Model == null || !Model.Any())
{
    <div class="panel-dark text-center py-5">
        <i class="bi bi-tag display-1 text-muted"></i>
        <h3 class="mt-3">No Discounts Created</h3>
        <p class="text-muted">Create promotional codes to boost sales!</p>
        <a href="@Url.Action("Create")" class="btn btn-accent mt-3"><i class="bi bi-plus-circle"></i> Create First Discount</a>
    </div>
}
else
{
    <div class="table-responsive panel-dark">
        <table class="table table-dark table-hover align-middle mb-0">
            <thead>
                <tr>
                    <th>Code</th>
                    <th>Discount</th>
                    <th>Valid Period</th>
                    <th>Status</th>
                    <th>Applicable Games</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var discount in Model)
            {
                var now = DateTime.UtcNow;
                var isActive = (!discount.StartDate.HasValue || discount.StartDate <= now) && (!discount.EndDate.HasValue || discount.EndDate >= now);
                var gameCount = discount.Games?.Count() ?? 0;
                <tr>
                    <td><code class="text-info">@discount.DiscountName</code></td>
                    <td><span class="badge bg-success">@(discount.DiscountPercent ?? 0)% OFF</span></td>
                    <td class="small">
                        @if (discount.StartDate.HasValue) { <div><i class="bi bi-calendar-check"></i> @discount.StartDate.Value.ToString("MMM dd, yyyy")</div> } else { <div>No start limit</div> }
                        @if (discount.EndDate.HasValue) { <div><i class="bi bi-calendar-x"></i> @discount.EndDate.Value.ToString("MMM dd, yyyy")</div> } else { <div>No end limit</div> }
                    </td>
                    <td>
                        @if (isActive) { <span class="badge bg-success"><i class="bi bi-check-circle"></i> Active</span> }
                        else if (discount.EndDate.HasValue && discount.EndDate < now) { <span class="badge bg-secondary"><i class="bi bi-x-circle"></i> Expired</span> }
                        else { <span class="badge bg-warning text-dark"><i class="bi bi-clock"></i> Scheduled</span> }
                    </td>
                    <td><span class="badge badge-soft">@gameCount game(s)</span></td>
                    <td class="text-end">
                        <a href="@Url.Action("Edit", new { id = discount.DiscountID })" class="btn btn-primary btn-sm"><i class="bi bi-pencil"></i></a>
                        <a href="@Url.Action("Details", new { id = discount.DiscountID })" class="btn btn-secondary btn-sm"><i class="bi bi-eye"></i></a>
                        <a href="@Url.Action("Delete", new { id = discount.DiscountID })" class="btn btn-danger btn-sm"><i class="bi bi-trash"></i></a>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
}

@section Styles {
<style>
.discount-card { transition:transform .2s; }
.discount-card:hover { transform:translateY(-2px); }
</style>
}
