@model GameHub.Models.Game
@{
    ViewBag.Title = "Edit Game";
}

<div class="hero-banner" style="background-image:url('/Content/hero-placeholder.jpg')">
    <div class="overlay">
        <h1 class="display-6"><i class="bi bi-pencil"></i> Edit Game</h1>
        <p class="lead">Update game information and cover image</p>
    </div>
</div>

<div class="panel-dark">
    @using (Html.BeginForm("Edit", "Games", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "alert alert-danger" })
        @Html.HiddenFor(model => model.GameID)

        <div class="row">
            <div class="col-md-8">
                <div class="mb-3">
                    <label class="form-label">Title *</label>
                    @Html.TextBoxFor(model => model.Title, new { @class = "form-control form-control-dark", required = "required" })
                    @Html.ValidationMessageFor(model => model.Title, "", new { @class = "text-danger" })
                </div>

                <div class="mb-3">
                    <label class="form-label">Genre *</label>
                    @Html.DropDownList("GenreID", null, "Select Genre", new { @class = "form-control form-control-dark", required = "required" })
                    @Html.ValidationMessageFor(model => model.GenreID, "", new { @class = "text-danger" })
                </div>

                <div class="mb-3">
                    <label class="form-label">Description</label>
                    @Html.TextAreaFor(model => model.Description, new { @class = "form-control form-control-dark", rows = 5, placeholder = "Enter game description..." })
                    @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Price ($) *</label>
                        @Html.TextBoxFor(model => model.Price, new { @class = "form-control form-control-dark", type = "number", step = "0.01", min = "0", required = "required" })
                        @Html.ValidationMessageFor(model => model.Price, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Release Date</label>
                        @Html.TextBoxFor(model => model.ReleaseDate, "{0:yyyy-MM-dd}", new { @class = "form-control form-control-dark", type = "date" })
                        @Html.ValidationMessageFor(model => model.ReleaseDate, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="mb-3">
                    <div class="form-check">
                        <input type="checkbox" name="IsAvailable" value="true" @(Model.IsAvailable == true ? "checked" : "") class="form-check-input" id="IsAvailable" />
                        <input type="hidden" name="IsAvailable" value="false" />
                        <label class="form-check-label" for="IsAvailable">Available for Purchase</label>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="panel-dark">
                    <h6 class="mb-3"><i class="bi bi-image"></i> Cover Image</h6>
                    <div class="mb-3">
                        <img id="coverPreview" src="/Content/covers/@(Model.GameID).jpg" class="img-fluid rounded" style="max-height: 300px; width: 100%; object-fit: cover;" onerror="this.src='/Content/cover-placeholder.jpg'" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Change Cover</label>
                        <input type="file" name="coverImage" id="coverImage" class="form-control form-control-dark" accept="image/*" />
                        <small class="text-muted">Leave empty to keep current cover</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-accent btn-lg"><i class="bi bi-check-circle"></i> Save Changes</button>
            <a href="@Url.Action("Index")" class="btn btn-secondary btn-lg"><i class="bi bi-x-circle"></i> Cancel</a>
            <a href="@Url.Action("Delete", new { id = Model.GameID })" class="btn btn-danger btn-lg float-end"><i class="bi bi-trash"></i> Delete Game</a>
        </div>
    }
</div>

@section Scripts {
    <script>
        document.getElementById('coverImage').addEventListener('change', function(e) {
            var file = e.target.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('coverPreview').src = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        });
    </script>
}
